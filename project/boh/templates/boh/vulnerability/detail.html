{% extends "boh/vulnerability/base_vulnerability.html" %}

{% load i18n %}
{% load boh_tags %}
{% load humanize %}
{% load markdown_render %}

{% block title %}{{ vulnerability.name }}{% endblock %}

{% block vulnerability_content %}
  <div class="row">
    <div class="col-md-8">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title"><span class="fa fa-lock" aria-hidden="true"></span> {% trans 'Vulnerablity Details' %}</h3>
        </div>
        <div class="panel-body">
          {% if vulnerability.affected_app %}
          <h4>{% trans 'Affected on' %}:&nbsp;<a href="{% url 'boh:application.overview' vulnerability.affected_app.id %}">{{ vulnerability.affected_app.name }}</a>
            {% if vulnerability.affected_version %}<small><em>({% trans 'Version' %}:&nbsp;{{ vulnerability.affected_version }})</em></small>{% endif %}</h4>
          {% endif %}
          <h4>{% trans 'Description' %}</h4>
          {% if vulnerability.description %}{{ vulnerability.description|markdown_render }}{% else %}<p class="text-muted"><small><em>{% trans 'No description.' %}</em></small></p>{% endif %}
          {% if vulnerability.environment %}
          <h4>{% trans 'Environment' %}</h4>
            {{ vulnerability.environment|markdown_render }}
          {% endif %}
          {% if vulnerability.pre_conditions %}
          <h4>{% trans 'Pre-conditions' %}</h4>
          {{ vulnerability.pre_conditions|markdown_render }}
          {% endif %}
          {% if vulnerability.reproduction_steps %}
          <h4>{% trans 'Steps to Reproduce' %}</h4>
          {{ vulnerability.reproduction_steps|markdown_render }}
          {% endif %}
          {% if vulnerability.attack_vector %}
            <h4>{% trans 'Attack Vector' %}</h4>
            {{ vulnerability.attack_vector|markdown_render }}
          {% endif %}
          <h4>{% trans 'Solution' %}</h4>
          {% if vulnerability.solution %}{{ vulnerability.solution|markdown_render }}{% else %}<p class="text-muted"><small><em>{% trans 'No Solution' %}</em></small></p>{% endif %}
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title"><span class="fa fa-info-circle fa-fw" aria-hidden="true"></span> {% trans 'Metadata' %}</h3>
        </div>
        <div class="table-responsive">
          <table class="table table-striped">
            <tbody>
            <tr>
              <td><strong>{% trans 'Severity' %}</strong></td>
              <td>{{ vulnerability.get_severity_display }}</td>
            </tr>
            <tr>
              <td><strong>{% trans 'Status' %}</strong></td>
              <td>{{ vulnerability.get_status_display }}</td>
            </tr>
            {% if vulnerability.detection_method %}
            <tr>
              <td><strong>{% trans 'Detection Method' %}</strong></td>
              <td>{{ vulnerability.get_detection_method_display }}</td>
            </tr>
            {% endif %}
            {% if vulnerability.reporter %}
            <tr>
              <td><strong>{% trans 'Reporter' %}</strong></td>
              <td>{{ vulnerability.reporter.first_name }}&nbspl{{ vulnerability.reporter.last_name }}</td>
            </tr>
            {% endif %}
            </tbody>
          </table>
        </div>
      </div>
      <small class="text-muted">
        <em>{% trans 'Created' %}: {{ vulnerability.created_date|naturaltime }}<br>
          {% trans 'Last modified' %}: {{ vulnerability.modified_date|naturaltime }}<br>
          {% if vulnerability.deadline %}{% trans 'Deadline' %}: {{ vulnerability.deadline }}<br>{% endif %}
          {% if vulnerability.is_fixed %}{% trans 'Fixed at' %}: {{ vulnerability.fixed_at|naturaltime }}<br>{% endif %}
          </em>
      </small>
    </div>
  </div>
  <div class="row">
    {% if vulnerability.is_editable%}
    <div class="col-md-12">
      <p><a href="{% url 'boh:vulnerability.edit' vulnerability.id %}" class="btn btn-default" role="button"><span class="fa fa-pencil-square-o" aria-hidden="true"></span> {% trans 'Edit Vulnerability' %}</a></p>
    </div>
    {% else %}
      <div class="col-md-12">
        <p><a href="{% url 'boh:vulnerability.reopen' vulnerability.id %}" class="btn btn-default" role="button"><span class="fa fa-pencil-square-o" aria-hidden="true"></span> {% trans 'Re-open Vulnerability' %}</a></p>
      </div>
    {% endif %}
  </div>
{% endblock vulnerability_content %}
